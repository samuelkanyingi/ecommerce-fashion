<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.12.0/dist/cdn.min.js" defer></script>




    <meta name="csrf-token" content="{{ csrf_token }}">
<script>
document.body.addEventListener('htmx:configRequest', (e) => {
    e.detail.headers['X-CSRFToken'] =
        document.querySelector('meta[name="csrf-token"]').content;
});
</script>




    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        body {
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .cartContainer {
            display: flex;
            gap: 30px;
        }
        .cart-items {
            flex: 2;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
        }
        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
        }
        .order-summary {
            flex: 1;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            height: fit-content;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="cartHeader">
            <a href="{% url 'women' %}">  <i class="fa fa-arrow-left"></i> Back</a>
            <h1>Shopping Cart</h1>
        </div>
        <div class="cartContainer" id="cartContainer">
            
            <div class="cart-items">
                {% for item in cart %}
                <div class="cart-item">
                    {% if '/media/' in item.image or 'media/' in item.image %}
                        <img src="{{ item.image }}" width="80" alt="">
                    {% else %}
                        <img src="/static/{{ item.image }}" width="80" alt="">
                    {% endif %}
                    <div style="flex: 1; margin: 15px;">
                        <h4>{{ item.name }}</h4>
                        <p>KES {{item.price }}</p>
                    </div>
                    <div style="display: flex; align-items:center; gap: 10px;">
                        <!-- <form method="post" action="{% url 'update_cart' %}">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="decrease">
                            <input type="hidden" name="name" value="{{item.name}}">
                            <button style="padding: 5px;">-</button>
                        </form> -->
                        <button 
                            hx-post="{% url 'update_cart' %}"
                            hx-target="#cartContainer"
                            hx-swap="outerHTML"
                            hx-vals='{"action":"decrease", "name": "{{ item.name }}"}'
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            style="padding: 1px 4px"
                            >
                            -
                        </button>
                        <strong>{{ item.quantity }} </strong>

                       
                        <button  
                            hx-post="{% url 'update_cart' %}"
                            hx-target="#cartContainer"
                            hx-swap="outerHTML"
                            hx-vals='{"action":"increase", "name": "{{ item.name }}"}'
                            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                            style="padding: 1px 4px"
                            > + </button>

                    <button 
                        hx-post="{% url 'remove_item' %}"
                        hx-target="#cartContainer"
                        hx-swap="outerHTML"
                        hx-vals='{"name": "{{ item.name }}"}'
                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                        style="color: red; border: none; background: none;"
                    >
                        <i class="fa fa-trash"></i></button>
                    </div>
                </div>
                {% empty %}
                <p>You cart is empty</p>
                {% endfor %}
            </div>
            <div class="order-summary" x-data="{ open: false, phone: '' }">
                <h2>orderSummary</h2>
                <p>Total: <strong>KES {{ total }}</strong></p>
                
                <button @click="open = true" 
        style="width: 100%; background-color: black; color: white; padding: 12px 20px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: background-color 0.3s;" 
        onmouseover="this.style.backgroundColor='#333'" 
        onmouseout="this.style.backgroundColor='black'">
    Pay with Mpesa
</button>




                <!-- Checkout Modal -->
<div 
    x-show="open"
    x-cloak
    style="position: fixed; inset:0; background: rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center;"
    @click.self="open=false"
>
    <div style="background:white; padding:20px; border-radius:8px; width: 300px;  margin: 250px 500px" >
        <h3>Enter your Phone Number</h3>
        <form hx-post="{% url 'stk_push' order_id=1 %}" hx-swap="none">
            <input 
                type="text" 
                name="phone"
                x-model="phone" 
                placeholder="2547XXXXXXXX" 
                style="width:95%; padding:8px; margin:10px 0;"
                required>
            <button 
                type="submit"
                @click="setTimeout(() => open=false, 100)"
                style="width:100%; padding:10px; background:black; color:white; border:none; border-radius:6px; font-weight:bold; cursor:pointer;"
            >
                Pay Now
            </button>
        </form>
        <button @click="open=false" style="margin-top:10px; width:100%; padding:10px; cursor:pointer;">Cancel</button>
    </div>
</div>




            </div>
        </div>
    </div>
    
</body>
</html>